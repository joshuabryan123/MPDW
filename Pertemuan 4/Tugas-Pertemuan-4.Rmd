---
title: "**MPDW PRAKTIKUM P4**"
author: "Joshua Bryan Wijaya_G1401231082"
date: "2025-09-22"
output:
  html_document:
    always_allow_html: true
    toc: true
    toc_float: true
    self_contained: true
  pdt_document:
    toc: true
    number_sections: true
    latex_engine: xelatex
    extra_dependencies: ["float", "xcolor", "graphicx"]
css: style2.css
editor_options:
  markdown:
    wrap: 72
---

# **PROSES MA(2)**
## **Pembangkitan Data**
### Pembangkitan Manual
```{r}
set.seed(1082)
n <- 300
wn <- rnorm(n, mean=0, sd=1)

ma2 <- numeric(n)
ma2[1:2] <- wn[1:2]

for(i in 3:n){
   ma2[i] <- wn[i] + 0.4 * wn[i - 1] + 0.6 * wn[i - 2]
}

ma2
```

<br>
Sebelum membangkitkan data MA(2), diberikan seed(1082) agar hasil data bangkitan konsisten dan tidak berubah-ubah. Sesuai ketentuan yang diberikan, data yang dibangkitkan akan mengikuti persamaan $$
Y_{t} = e_{t} - \theta_{1} e_{t-1} - \theta_{2} e_{t-2}$$
. Jumlah data yang akan dibangkitkan adalah **300 amatan**, dimana sebaran harus bersifat *white noise*, karena itu wn dibuat menyebar normal dengan nilai tengah 0 dan ragam 1. Selanjutnya, dibuat vektor kosong (ma2) untuk menampung data bangkitan. Pengamatan 1 hingga 2 pada ma2 diisi dengan bawaan dari sebaran normal (wn) karena untuk proses MA(2), dibutuhkan data residual pada 2 lag sebelumnya. Selanjutnya untuk amatan 3 hingga 300, sudah diisi dengan looping yang mengikuti persamaan MA(2) dengan $\theta_{1}$ = 0.4 dan $\theta_{2}$ = 0.6.

### Pembangkitan Arima.sim
```{r}
set.seed(1082)
ma2_sim <- arima.sim(list(order=c(0,0,2), ma=c(0.4, 0.6)), n=300)
ma2_sim
```

## **Plot Time Series**
### Plot Deret Waktu
```{r}
par(mfrow = c(1, 2))
ts.plot(ma2)
ts.plot(ma2_sim)
```
<br>
Pada plot deret waktu, baik pada data bangkitan manual maupun menggunakan fungsi, terlihat bahwa data menyebar disekitar 0 dan memiliki keragaman yang cenderung homogen. Dapat dikatakan bahwa model MA(2) yang dibangkitkan sudah stasioner.

### Plot ACF
```{r}
par(mfrow = c(1, 2))
acf(ma2,lag.max = 20)
acf(ma2_sim, lag.max = 20)
```
<br>
Pada plot ACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 0, sehingga pada lag 0, wajar bahwa nilai autokorelasi yang ditunjukkan adalah 1. Selanjutnya, terlihat bahwa proses MA(2) mengalami **cut-off** pada lag kedua. Ini membuktikan sifat proses MA(2), dimana korelasi untuk $ lag \geq 3 $ akan bernilai 0.

### Plot PACF
```{r}
par(mfrow = c(1, 2))
pacf(ma2)
pacf(ma2_sim)
```
<br>
Pada plot PACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 1. Selanjutnya, terlihat bahwa proses MA(2) mengalami **tail-off** pada lag kedua hingga seterusnya. Ini membuktikan sifat proses MA(2), dimana pada lag kedua hingga seterusnya, nilai PACF menurun perlahan secara eksponensial.

### Plot EACF
```{r}
TSA::eacf(ma2)
TSA::eacf(ma2_sim)
```
<br>
Berdasarkan plot EACF, cukup terlihat jelas bahwa kedua model MA(2), baik bangkitan secara manual maupun mennggunakan fungsi sama-sama menunjukkan pola segitiga nol pada ordo AR(0) dan MA(2). Hal ini mengindikasikan bahwa data deret waktu yang dibangkitkan merupakan model **Moving Average dengan q=2**

## **Scatter Plot Antar Lag**
### Yt vs Yt-1
```{r}
yt_1 <- ma2[-1]
yt_1_ma2 <- ma2[-300]
plot(y=yt_1,x=yt_1_ma2)
```

### Yt vs Yt-2
```{r}
yt_2 <- ma2[-c(1,2)]
yt_2_ma2 <- ma2[-c(299,300)]
plot(y=yt_2,x=yt_2_ma2)
```

### Yt vs Yt-3
```{r}
yt_3 <- ma2[-c(1,2,3)]
yt_3_ma2 <- ma2[-c(298,299,300)]
plot(y=yt_3,x=yt_3_ma2)
```

<br>
Pada model MA(2), terlihat bahwa korelasi $Y_t$ dengan dirinya sendiri pada lag 1 dan lag 2 masih menjunjukkan hubungan linear positif. Akan tetapi, saat dikorelasikan dengan dirinya sendiri pada lag 3, cenderung menunjukkan tidak adanya hubungan linear. Hal ini juga masih mengikuti sifat MA(2) dimana ACF nya mengalami **cut-off** pada lag kedua.

## **Autokorelasi**
### Empiris (bangkitan)
#### Dengan korelasi
```{r}
cat("rho_0 =", cor(ma2, ma2), "\n")
cat("rho_1 =", cor(yt_1, yt_1_ma2), "\n")
cat("rho_2 =", cor(yt_2, yt_2_ma2), "\n")
cat("rho_3 =", cor(yt_3, yt_3_ma2), "\n")
```
#### Dengan Fungsi
```{r}
acf_emp <- acf(ma2, plot=FALSE)
acf_emp$acf[1:4]
```

### Teoritis
$$\rho_0 = 1$$
$$ \rho_1 = \frac{-\theta_1+\theta_1\theta_2}{1+{(-\theta_1)^2}+{(-\theta_2)^2}} = \frac{-(-0.4)+(-0.4)(-0.6)}{1+(-0.4)^2+(-0.6)^2} \approx 0.421 $$


$$ \rho_2 = \frac{-\theta_2}{1+{(-\theta_1)^2}+{(-\theta_2)^2}} = \frac{-(-0.6)}{1+(-0.4)^2+(-0.6)^2} \approx 0.395 $$

$$ \rho_k = 0, k>2 $$
```{r}
theta1 <- 0.4; theta2 <- 0.6; sigma2 <- 1
gamma0 <- (1 + theta1^2 + theta2^2) * sigma2
gamma1 <- (theta1 + theta1*theta2) * sigma2
gamma2 <- theta2 * sigma2

rho0 <- gamma0/gamma0
rho1 <- gamma1/gamma0
rho2 <- gamma2/gamma0
rho3 <- 0

c(rho0, rho1, rho2, rho3)
```

### Perbandingan
|             | Lag 0        | Lag 1        | Lag 2        | Lag 3        |
|-------------|--------------|--------------|--------------|--------------|
| Empiris     | 1        | 0.4395        | 0.3744        | 0.0056        |
| Teoritis    | 1         | 0.4210        | 0.3947         | 0         |

<br>
Terlihat bahwa nilai autokorelasi pada data empiris mendekati nilai autokorelasi secara teoritis. Meskipun model MA(2) mengalami cut-off pada lag kedua, akan tetapi nilai lag ketiga pada data empiris tidak benar-benar menyentuh angka 0, hanya mendekati nilai 0.

# **PROSES AR(2)**
## **Pembangkitan Data**
### Pembangkitan Manual
```{r}
set.seed(1082)
ar2 <- numeric(n)
ar2[1:2] <- wn[1:2]

for (i in 3:n) {
  ar2[i] <- wn[i] + 0.5 * ar2[i-1] + 0.2 * ar2[i-2]
}

ar2
```

<br>
Sebelum membangkitkan data AR(2), diberikan seed(1082) agar hasil data bangkitan konsisten dan tidak berubah-ubah. Sesuai ketentuan yang diberikan, data yang dibangkitkan akan mengikuti persamaan $$
Y_{t} = \phi_{1} Y_{t-1} + \phi_{2} Y_{t-2} + e_{t}$$

.Jumlah data yang akan dibangkitkan adalah **300 amatan**, dimana sebaran harus bersifat *white noise*, karena itu wn dibuat menyebar normal dengan nilai tengah 0 dan ragam 1. Selanjutnya, dibuat vektor kosong (ar2) untuk menampung data bangkitan. Pengamatan 1 hingga 2 pada ar2 diisi dengan bawaan dari sebaran normal (wn) karena untuk proses AR(2), dibutuhkan data residual pada 2 lag sebelumnya. Selanjutnya untuk amatan 3 hingga 300, sudah diisi dengan looping yang mengikuti persamaan AR(2) dengan $\phi_{1}$ = 0.5 dan $\phi_{2}$ = 0.2.

### Pembangkitan Arima.sim

```{r}
set.seed(1082)
ar2_sim <- arima.sim(model=list(order=c(2,0,0), ar=c(0.5, 0.2)), n=300)
ar2_sim
```

## **Plot Time Series**

### Plot Deret Waktu

```{r}
par(mfrow = c(1, 2))
ts.plot(ar2)
ts.plot(ar2_sim)
```
<br>
Pada plot deret waktu, baik pada data bangkitan manual maupun menggunakan fungsi, terlihat bahwa data menyebar disekitar 0 dan memiliki keragaman yang cenderung homogen. Dapat dikatakan bahwa model AR(2) yang dibangkitkan sudah stasioner.

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(ar2)
acf(ar2_sim)
```
<br>
Pada plot ACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 0, sehingga pada lag 0, wajar bahwa nilai autokorelasi yang ditunjukkan adalah 1. Selanjutnya, terlihat bahwa proses AR(2) mengalami **tail-off** pada lag kedua hingga seterusnya. Ini membuktikan sifat proses AR(2), dimana pada lag kedua hingga seterusnya, nilai PACF menurun perlahan secara eksponensial. Sifat ini berkebalikan dengan plot ACF pada MA(2).

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(ar2)
pacf(ar2_sim)
```
<br>
Pada plot PACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 1. Selanjutnya, terlihat bahwa proses AR(2) mengalami **cut-off** pada lag kedua.

### Plot EACF

```{r}
TSA::eacf(ar2)
TSA::eacf(ar2_sim)
```
<br>
Berdasarkan plot EACF, cukup terlihat jelas bahwa kedua model AR(2), baik bangkitan secara manual maupun mennggunakan fungsi sama-sama menunjukkan pola segitiga nol pada ordo AR(2) dan MA(0). Hal ini mengindikasikan bahwa data deret waktu yang dibangkitkan merupakan model **Autoregressive dengan p=2**

## **Scatter Plot Antar Lag**
### Yt vs Yt-1
```{r}
yt_1 <- ar2[-1]
yt_1_ar2 <- ar2[-300]
plot(y=yt_1,x=yt_1_ar2)
```

### Yt vs Yt-2
```{r}
yt_2 <- ar2[-c(1,2)]
yt_2_ar2 <- ar2[-c(299,300)]
plot(y=yt_2,x=yt_2_ar2)
```

### Yt vs Yt-3
```{r}
yt_3 <- ar2[-c(1,2,3)]
yt_3_ar2 <- ar2[-c(298,299,300)]
plot(y=yt_3,x=yt_3_ar2)
```
Model AR(2) menunjukkan pola yang cenderung positif linier pada ketiga lag. Namun, Ketika jarak lag semakin besar, maka terjadi penurunan kekuatan hubungan linear antara $Y_t$ dengan lag dirinya sendiri. Dapat dilihat bahwa hubungan linear positif yang paling lemah terjadi pada korelasi antara $Y_t$ dengan $Y_{t-3}$.

## **Autokorelasi**
### Empiris (bangkitan)
#### Dengan Korelasi
```{r}
cat("rho_0 =", cor(ar2, ar2), "\n")
cat("rho_1 =", cor(yt_1, yt_1_ar2), "\n")
cat("rho_2 =", cor(yt_2, yt_2_ar2), "\n")
cat("rho_3 =", cor(yt_3, yt_3_ar2), "\n")
```

#### Dengan Fungsi
```{r}
acf_emp <- acf(ar2, plot=FALSE)
acf_emp$acf[1:4]
```

### Teoritis
$$\rho_0 = 1$$
$$ \rho_1 = \frac{\phi_1}{1-\phi_2}=\frac{0.5}{1-0.2} = 0.625 $$


$$ \rho_2 = \phi_1\rho_1+\phi_2\rho_0 = \frac{\phi_1^2+\phi_2(1-\phi_2)}{1-\phi_2}=\frac{(0.5)^2+0.2(1-0.2)}{1-0.2} = 0.5125 $$

$$ \rho_3 = \phi_1\rho_2+\phi_2\rho_1 + \phi_3\rho_0 = (0.5)(0.5125)+(0.2)(0.625)=0.38125$$
```{r}
phi1 <- 0.5
phi2 <- 0.2

rho <- numeric(4) 
rho[1] <- 1
rho[2] <- phi1 / (1 - phi2)
rho[3] <- phi1 * rho[2] + phi2
rho[4] <- phi1 * rho[3] + phi2 * rho[2]

rho

```

### Perbandingan
|             | Lag 0        | Lag 1        | Lag 2        | Lag 3        |
|-------------|--------------|--------------|--------------|--------------|
| Empiris     | 1        | 0.8266        | 0.7908   | 0.5659        |
| Teoritis    | 1         | 0.6250        | 0.5125         | 0.3813         |

<br>
Terlihat bahwa nilai autokorelasi pada data empiris mendekati nilai autokorelasi secara teoritis.Meskipun, terdapat perbedaan pada kecepatan penurunannya, jika dihitung secara teoritis dibandingkan dengan data empiris.

# **PROSES ARMA(2,2)**
## **Pembangkitan Data**
### Pembangkitan Manual
```{r}
set.seed(1082)
phi1 <- 0.5
phi2 <- 0.2
theta1 <- 0.4
theta2 <- 0.6

arma22 <- numeric(n)
arma22[1:2] <- wn[1:2]

for (i in 3:n){
  arma22[i] <- phi1 * arma22[i-1] +
             phi2 * arma22[i-2] +
             wn[i] +
             theta1 * wn[i-1] +
             theta2 * wn[i-2]
}

arma22 <- ts(arma22)
arma22
```

<br>
Sebelum membangkitkan data ARMA(2,2), diberikan seed(1082) agar hasil data bangkitan konsisten dan tidak berubah-ubah. Sesuai ketentuan yang diberikan, data yang dibangkitkan akan mengikuti persamaan $$
Y_{t} = \phi_{1} Y_{t-1} + \phi_{2} Y_{t-2} + e_{t} + \theta_{1} e_{t-1} + \theta_{2} e_{t-2}$$
.Jumlah data yang akan dibangkitkan adalah **300 amatan**, dimana sebaran harus bersifat *white noise*, karena itu wn dibuat menyebar normal dengan nilai tengah 0 dan ragam 1. Selanjutnya, dibuat vektor kosong (arma22) untuk menampung data bangkitan. Pengamatan 1 hingga 2 pada arma22 diisi dengan bawaan dari sebaran normal (wn) karena untuk proses ARMA(2,2), dibutuhkan data residual pada 2 lag sebelumnya. Selanjutnya untuk amatan 3 hingga 300, sudah diisi dengan looping yang mengikuti persamaan ARMA(2,2) dengan $\theta_{1}$ = 0.4,  $\theta_{1}$ = 0.6, $\phi_{1}$ = 0.5, dan $\phi_{2}$ = 0.2.


### Pembangkitan arima.sim

```{r}
set.seed(1082)
arma22_sim <- arima.sim(list(order=c(2,0,2), ma=c(0.4, 0.6), ar=c(0.5, 0.2)), n=300)
arma22_sim
```

## **Plot Time Series**
### Plot Deret Waktu
```{r}
par(mfrow = c(1, 2))
ts.plot(arma22)
ts.plot(arma22_sim)
```
<br>
Pada plot deret waktu, baik pada data bangkitan manual maupun menggunakan fungsi, terlihat bahwa data menyebar disekitar 0 dan memiliki keragaman yang cenderung homogen. Dapat dikatakan bahwa model ARMA(2,2) yang dibangkitkan sudah stasioner.

### Plot ACF

```{r}
par(mfrow = c(1, 2))
acf(arma22)
acf(arma22_sim)
```
<br>
Pada plot ACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 0, sehingga pada lag 0, wajar bahwa nilai autokorelasi yang ditunjukkan adalah 1. Selanjutnya, terlihat bahwa proses ARMA(2,2) mengalami **tail-off** pada lag kedua hingga seterusnya. Ini membuktikan sifat proses ARMA(2,2), dimana pada lag kedua hingga seterusnya, nilai ACF menurun perlahan secara eksponensial. Sifat ini berkebalikan dengan plot ACF pada MA(2).

### Plot PACF

```{r}
par(mfrow = c(1, 2))
pacf(arma22)
pacf(arma22_sim)
```
<br>
Pada plot PACF, baik pada data bangkitan secara manual maupun menggunakan fungsi, grafik dimulai dari lag 1. Selanjutnya, terlihat bahwa proses ARMA(2,2) mengalami **tail-off** pada lag kedua hingga seterusnya. Ini membuktikan sifat proses ARMA(2,2), dimana pada lag kedua hingga seterusnya, nilai PACF menurun perlahan secara eksponensial. Sifat ini berlawanan dengan sifat PACF model AR(2) yang justru mengalami cut-off pada lag kedua. 

### Plot EACF

```{r}
TSA::eacf(arma22)
TSA::eacf(arma22_sim)
```
<br>
Berdasarkan plot EACF, cukup terlihat jelas bahwa model ARMA(2,2) yang dibangkitkan secara manual memiliki pola segitiga nol pada AR(2) dan MA(2). Akan tetapi, plot EACF untuk model ARMA(2,2) yang dibangkitkan dengan fungsi, kurang menunjukkan hal tersebut. Dari plot EACF, dapat terlihat bahwa data yang dibangkitkan secara manual merupakan model **Autoregressive Moving Average dengan p =2 dan q=2**

## **Scatter Plot Antar Lag**

### Yt vs Yt-1

```{r}
yt_1 <- arma22[-1]
yt_1_arma22 <- arma22[-300]
plot(y=yt_1,x=yt_1_arma22)
```

### Yt vs Yt-2

```{r}
yt_2 <- arma22[-c(1,2)]
yt_2_arma22 <- arma22[-c(299,300)]
plot(y=yt_2,x=yt_2_arma22)
```

### Yt vs Yt-3

```{r}
yt_3 <- arma22[-c(1,2,3)]
yt_3_arma22 <- arma22[-c(298,299,300)]
plot(y=yt_3,x=yt_3_arma22)
```
<br>
Model ARMA(2,2) menunjukkan pola yang cenderung positif linier pada ketiga lag. Namun, Ketika jarak lag semakin besar, maka terjadi penurunan kekuatan hubungan linear antara $Y_t$ dengan lag dirinya sendiri. Dapat dilihat bahwa hubungan linear positif yang paling lemah terjadi pada korelasi antara $Y_t$ dengan $Y_{t-3}$. Hal ini memiliki kemiripan sifat dengan AR(2)

## **Autokorelasi**
### Empiris (bangkitan)
#### Dengan Korelasi
```{r}
cat("rho_0 =", cor(arma22, arma22), "\n")
cat("rho_1 =", cor(yt_1, yt_1_arma22), "\n")
cat("rho_2 =", cor(yt_2, yt_2_arma22), "\n")
cat("rho_3 =", cor(yt_3, yt_3_arma22), "\n")
```

#### Dengan Fungsi
```{r}
acf_emp <- acf(arma22, plot=FALSE)
acf_emp$acf[1:5]
```

### Teoritis
#### Hitung Manual
```{r}
phi1  <- 0.5
phi2  <- 0.2
theta1 <- 0.4
theta2 <- 0.6
sigma2 <- 1  

psi <- numeric(11)      
psi[1] <- 1
psi[2] <- phi1 + theta1
psi[3] <- phi2 + phi1*psi[2] + theta2
for(k in 4:11){
  psi[k] <- phi1*psi[k-1] + phi2*psi[k-2]
}

gamma <- numeric(5)
for(k in 0:4){
  gamma[k+1] <- sigma2 * sum(psi[1:(11-k)] * psi[(1+k):(11)])
}

rho <- gamma / gamma[1]
rho[1:5]

```

#### Dengan Fungsi
```{r}
phi <- c(0.5, 0.2)
theta <- c(0.4, 0.6)

rho_arma22 <- ARMAacf(ar=phi, ma=theta, lag.max=4)
rho_arma22
```

### Perbandingan
|             | Lag 0        | Lag 1        | Lag 2        | Lag 3        | Lag 4        |
|-------------|--------------|--------------|--------------|--------------|--------------|
| Empiris     | 1        | 0.8653        | 0.7525   | 0.5619        | 0.4461      |
| Teoritis (Manual)   | 1         | 0.8572        | 0.7449         | 0.5389        | 0.4118|
| Teoritis (Fungsi)   | 1         | 0.8592        | 0.7492         | 0.5464        | 0.4230|

<br>
Terlihat bahwa nilai autokorelasi pada data empiris mendekati nilai autokorelasi secara teoritis.Meskipun, terdapat sedikit perbedaan pada kecepatan penurunannya, jika dihitung secara teoritis dibandingkan dengan data empiris.

# **KESIMPULAN**

| Model    | ACF                                           | PACF                                          |
|----------|-----------------------------------------------|-----------------------------------------------|
| MA(2)    | Cut off setelah lag 2                        | Tail off (decay perlahan, bisa eksponensial)  |
| AR(2)    | Tail off (decay perlahan, bisa eksponensial)  | Cut off setelah lag 2                        |
| ARMA(2,2)| Tail off (decay perlahan)                     | Tail off (decay perlahan)                     |
