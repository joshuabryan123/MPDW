---
title: "**TUGAS MPDW PERTEMUAN 6**"
author: "Joshua Bryan Wijaya~G1401231082"
date: "2025-10-1"
output:
  html_document:
    always_allow_html: true
    toc: true
    toc_float: true
    self_contained: true
  pdt_document:
    toc: true
    number_sections: true
    latex_engine: xelatex
    extra_dependencies: ["float", "xcolor", "graphicx"]
css: style2.css
editor_options:
  markdown:
    wrap: 72
---

# **LIBRARY**
```{r}
library(forecast)
library(graphics)
library(TTR)
library(TSA)
library(dplyr)
library(rio)
library(readxl)
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
```

# **DATA**
```{r}
data <- read_xlsx("C:/JOSHUA BRYAN WIJAYA/SEMESTER 5/MPDW/Joshua.xlsx")
summary(data)
head(data)
```

<br>
<span style="background-color: #FFFF99">Data yang digunakan adalah data rataan temperatur di Kab. Bogor, dimulai dari rentang waktu 20 Desember 2024 hingga 26 Agustus 2025</span>


# **EKSPLORASI DATA**
```{r}
data <- data %>% dplyr::select(date,temp_mean)
str(data)
dim(data)

colSums(is.na(data))
data[!complete.cases(data), ]
```

<br>
<span style="background-color: #FFFF99">Ditemukan 2 amatan yang null alias tidak memiliki nilai. Selanjutnya, untuk menangani hal ini, akan dilakukan imputasi nilai menggunakan rataan dari seluruh nilai temp_mean.</span>

# **IMPUTASI DATA KOSONG**
```{r}
mean_val <- mean(data$temp_mean, na.rm = TRUE)
data$temp_mean[is.na(data$temp_mean)] <- mean_val

colSums(is.na(data))
data[!complete.cases(data), ]
```
<br>
<span style="background-color: #FFFF99"> Setelah dilakukan imputasi data, tidak lagi ditemukan nilai kosong pada data. Imputasi nilai kosong dilakukan dengan menggunakan nilai rataan dari Yt(temperature_mean). Sekarang data sudah siap untuk dianalisis dengan metode smoothing</span>


# **PLOT DERET WAKTU**
```{r}
data.ts <- ts(data$temp_mean)
```

```{r}
head(data.ts)
```


```{r}
plot_data <- data.ts |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
plot_data
```
<br>
<span style="background-color: #FFFF99"> Terlihat pada plot time series, data memiliki tren naik dari periode 50 hingga seterusnya. Kemungkinan besar, data tidak stasioner pada rataannya, namun stasioner pada ragam, karena terlihat bahwa amplitudo data di tiap periodenya cukup konstan.</span>


# **EKSPLORASI KESTASIONERAN DATA**
## **Kestasioneran dalam Rataan**
```{r}
mean(data.ts)
lattice::densityplot(as.vector(data.ts))
```
<br>
<span style="background-color: #FFFF99"> Diperoleh nilai rata-rata sebesar 25.81. Dari density plot data, terlihat bahwa data cenderung berkumpul di angka 25.5 hingga 26. Ini bisa jadi pertanda baik untuk kestasioneran dalam rataan. Namun, uji lanjutan tetap perlu dilakukan.</span>

## **Plot ACF**
```{r}
acf(data.ts)
```
<br>
<span style="background-color: #FFFF99"> Terlihat bahwa plot ACF di atas membentuk pola *tails off** cukup panjang (turun perlahan). Hasil plot ACF baru terlihat tidak signifikan pada lag 12, dan dari lag 19 hingga seterusnya, terlihat adanya kecenderungan untuk membentuk pola gelombang sinus.Dari sini, terlihat bahwa data masih punya kecenderungan pola tren yang tentunya harus diselidiki lebih lanjut dengan uji formal.</span>

## **Uji ADF**
<br>
$H_0$ : Data Tidak Stasioner dalam Rataan <br>
$H_1$ : Data Stasioner dalam Rataan
```{r}
tseries::adf.test(data.ts)
```
<br>
<span style="background-color: #FFFF99"> Terlihat bahwa hasil uji ADF menunjukkan nilai $P - Value > 0.05$. Sehingga keputusan yang diambil adalah tak cukup bukti untuk tolak $H_0$. Artinya, **data tidak stasioner dalam rataan**. Hsail ini sesuai dengan plot time series dan plot ACF sebelumnya.</span>

# **EKSPLORASI KESTASIONERAN DALAM RAGAM**
```{r}
index <- seq(1:250)
bc <- boxcox(
  data.ts ~ index,
  lambda = seq(-7, 7, by = 0.01)
)
```

```{r}
lambda <- bc$x[which.max(bc$y)]
cat("Lambda Optimum: ", lambda)
```

```{r}
ci_lambda <- bc$x[bc$y > max(bc$y) - 0.5 * qchisq(0.95, 1)]
ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```
<br>
<span style="background-color: #FFFF99"> Terlihat bahwa selang kepercayaan untuk lambda memiliki batas bawah -3, dan batas atas 4.59. Hal ini menunjukkan bahwa **lambda = 1** terdapat dalam selang. Hasil ini dapat diartikan bahwa **data stasioner dalam ragam**</span>


## **Partisi Data**
```{r}
data.ts |> 
  as_tsibble(index = index) |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() +
  geom_vline(xintercept = 100, linetype = "dashed", color = "red") +
  theme_bw()
```
<br>
### Partisi 1
```{r}
data_partisi1 <- data.ts[1:100] |> ts()
mean(data_partisi1)
var(data_partisi1)
```
### Partisi 2
```{r}
data_partisi2 <- data.ts[101:250] |> ts()
mean(data_partisi2)
var(data_partisi2)
```
<br>
<span style="background-color: #FFFF99"> Setelah di grid, anehnya rataan dari kedua bagian justru hampir sama (seakan-akan data stasioner dalam rataan). Kemudian, untuk ragamnya terlihat ada perubahan yang cukup besar. </span>

# **PENANGANAN I : DIFFERENCING**
```{r}
postrend_diff1 <- diff(data.ts, differences = 1)
ts.plot(postrend_diff1,
        main = "First-order Differencing dari postrend",
        col = "blue", lwd = 2)
```

```{r}
length(postrend_diff1)
```

<br>
<span style="background-color: #FFFF99"> Secara definisi, melakukan differencing terhadap model berarti:
$$y_t= X_t -X_{t-1}$$</span>.
<br>
Untuk differencing periode pertama, kita tidak memiliki data untuk diselisihkan, maka dari itu, proses selisihnya baru bisa dimulai dari lag kedua hingga seterusnya. Karena itulah, panjang data hasil differencing berkurang 1. Selan itu, hasil plot setelah *differencing* ordo 1 sangatlah memuaskan, dimana data terlihat sudah memiliki rataan konstan, tetapi amplitudo setiap periodenya justru terlihat berbeda.

## **Plot ACF Setelah Penanganan**
```{r}
acf(postrend_diff1)
```
<br>
<span style="background-color: #FFFF99"> Setelah dilakukan differencing ordo 1, terlihat bahwa plot ACF di atas tidak mengalami penurunan perlahan. Hasil plot ACF baru langsung tidak signifikan pada lag 2. Pattern data juga sudah berosilasi di sekitar angka 0 dan hanya sedikit lag saja yang signifikan pada plot ACF. ini merupakan pertanda bahwa **data sudah stasioner dalam rataan**.</span>

## **Uji ADF setelah Penanganan**
$H_0$ : Data Tidak Stasioner dalam Rataan <br>
$H_1$ : Data Stasioner dalam Rataan
```{r}
tseries::adf.test(postrend_diff1)
```
<br>
<span style="background-color: #FFFF99"> Terlihat bahwa hasil uji ADF menunjukkan nilai $P - Value < 0.05$ (bahkan lebih kecil seharusnya dari 0.1, tapi uji ADF di R hanya menampilkan nilai 0.01 keatas). Sehingga keputusan yang diambil adalah cukup bukti untuk tolak $H_0$. Artinya, **data stasioner dalam rataan**. Hsail ini sesuai dengan plot time series dan plot ACF sebelumnya.</span>

## **Rataan Partisi setelah penanganan**
### Partisi 1
```{r}
data_partisi1 <- postrend_diff1[1:100] |> ts()
mean(data_partisi1)
var(data_partisi1)
```


### Partisi 2
```{r}
data_partisi2 <- postrend_diff1[101:249] |> ts()
mean(data_partisi2)
var(data_partisi2)
```

## **Kestasioneran dalam Varian setelah penanganan**
```{r}
min(postrend_diff1)
postrend_shift <- postrend_diff1 + 3
index <- seq_along(postrend_shift)

bc <- boxcox(postrend_shift ~ index,
             lambda = seq(-4, 8, by = 0.01))
```

```{r}
lambda <- bc$x[which.max(bc$y)]
cat("Lambda Optimum: ", lambda)
```

```{r}
ci_lambda <- bc$x[bc$y > max(bc$y) - 0.5 * qchisq(0.95, 1)]
ci_lower <- min(ci_lambda)
ci_upper <- max(ci_lambda)

c(Batas_Bawah = ci_lower, Batas_Atas = ci_upper)
```
<br>
<span style="background-color: #FFFF99"> Setelah dilakukan differencing ordo 1, nilai data ada yang negatif, karena itu, sebelum dialkukan uji box-cox, nilai y digeser dlu 3 satuan keatas. Hal ini tidak akan memengaruhi keragaman pada data. Selanjutnya, karena nilai lambda = 1 terdapat pada selang kepercayaan lambda, maka **data stasioner dalam ragam**.</span>

# **KESIMPULAN**
Diagnosa awal data temperatur Kab.Bogor adalah **stasioner dalam ragam, namun tidak stasioner dalam rataan**. Penanganan yang efektif adalah *differencing*. Ternyata, differencing ordo 1 sudah cukup untuk membuat data stasioner dalam rataan, serta tentunya tetap mempertahankan kestasionerannya dalam ragam.












